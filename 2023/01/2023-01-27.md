# 2023-01-27

## Spring 관련

### 스코프

일단 크게 기본적으로 소개되어진 빈의 스코프 종류는 두 가지였다.

1. 싱글톤
2. 프로토타입

#### 싱글톤

싱글톤의 경우 처음에 앱이 실행 당시에 생성이 되어 관리가 되어지는 빈이고 특이한 점은 요청할 때마다 같은 객체가 반환이 되어진다는 것이다.

싱글톤 빈은 앱 생명주기와 동일하다고 볼 수 있고 기본값으로 설정이 되어진다.


#### 프로토타입

해당 빈의 생명주기는 클라이언트가 요청할 때마다 생성이 되어지고 그 이후에는 관리가 되어지지는 않는다.

인간 사회에서의 카페에서 테이크 아웃받은 플라스틱 컵 같은 느낌? 이다.

음료를 담아서 주기까지는 했는데 그 이후에 일은 어떻게 될지는 고려를 안한다.

이렇게 두 개의 스코프는 크게 두 가지의 다른 점이 있다.
1. 관리의 대상인가?
2. 생성은 몇번 이뤄지는가?

그렇다면 만약에 싱글톤 스코프를 가지는 빈에 프로토 타입의 스코프를 가지는 빈을 주입하면 어떻게 될까?

정답은 해당 싱글톤 빈과 같은 생명주기를 가지는 프로토타입 빈이 생성이 되어진다.

프로토타입은 호출될 때마다 생성되어지는 것인데 싱글톤 빈의 경우 처음 호출 이후에는 다시 생성을 안한다.
그말은 싱글톤 안에 갇힌 프로토타입 빈도 그 상태 그대로 존재하게 된다.
그러면 우리가 의도한 대로 동작을 안한다. 프로토타입이니까 싱글톤 안에 프로토 타입을 사용할 때 마다 새롭게 생성되는 줄 알겠지만
기존 프로토타입을 쓰는 것이다.

그래서 이것을 해결하기 위해서는 싱글톤 빈 로직안에서 프로토타입의 빈을 사용하는 부분에서 주입을 하는 것이 이상적이다.

그래서 해당 부분을 해결하기 위해서 DL(Dependency Lookup) 로 해결을 하는데 
내가 이해한 DL은 주입을 하는 것이 아닌 얘가 나중에 주입이 될 수 있다는 것을 알려준다. 라는 것이다.
그러니까 알아둬라는 거고 주입은 나중에 필요할 때 호출할 게 이런느낌? 그러면 호출 당시에 해당하는 빈이 주입되어 생성되어진다. 라는 느낌이다.
그리고 이것도 두 가지의 방법이 존재한다.

1. ObjectProvider(스프링에 의존)
2. Provider(스프링에 의존 X, 2.xxx = javax, 3.xxx jakatra) 를 이용한다.

1번과 2번은 유사하다. Provider 를 통해서 해당하는 빈을 지연된 시점에 가져오는 것이다.

2번의 경우에는 스프링에 의존성이 없으니 좋기는 하다.

다만, 대부분의 어플리케이션이 만들어질 때 스프링에 의존을 갖는 경우가 많다보니 그러한 경우에는 1번을 선택해도 좋다.

그리고 웹에서 소개된 
#### 리퀘스트 스코프이다.

이것은 웹에 국한이 되어지는데 우리가 흔히 서버에서 요청을 받으면 응답을 보내기까지의 생명 주기를 가지는데 해당 생명 주기를 가지는 것이
리퀘스트 스코프 빈이다.

문제는 해당하는 스코프를 사용하려고 하면 예외가 터지는데 이유는 처음에 앱이 돌아갈 때 해당 빈은 생성이 안되어지기 때문이다.

요청이 없으니 생성이 될 수가 없다. 그러니 이것을 해결하기위해 이전에 사용한 DL 을 이용하거나 다른 방법인 proxyMode 를 사용한다.

CGLIB 를 통해서 만들어진 빈을 등록후 해당하는 빈을 통해서 원본의 객체를 생성하는 것이다.

이렇게 하면 처음에 앱이 돌아갈 때 프록시로 생성된 빈이 올라가고 나중에 해당 빈을 이용할 때에 리퀘스트 스코프 빈을 이용하게 되어 사용이 가능하다.

## 여담
Python 개발자로 커리어를 쌓으면서 생각을 했을 때 뭔가 제대로 어플리케이션을 만들려고 하면
설계적으로 부족해보이는 부분이 많이 보인다.

그러다보니 약간의 해소가 되어지지 않는 부분(설계적인 불편함)들을 애써 남겨둔체 진행을 할 때가 있는데 그러한 문제점이 발생하는 이유가 몇 가지가 있는 것 같다.

내가 바로 생각나는 것은 
1. 언어의 발전 방향
2. 프레임워크의 성숙도

이렇게 2가지가 일단 보인다.

이렇게 생각하는 이유는 python은 일단 쉽다. 직관적이고 코딩을 하고 보면 읽기가 너무 편하다.
하지만 해당하는 부분이 단점으로 다가오는 부분도 있다 너무 동적인 언어이다 보니 예측이 어렵다라는 단점이 있다.

그래서 그런지 요즘은 type hint 를 적극지원하려고 하는 것처럼 보인다.

간단한 예로 
[fastapi 예제](https://fastapi.tiangolo.com/tutorial/body-nested-models/#__tabbed_2_1)를 보면 example이 3.6, 3.9, 3.10 으로 나뉘어진 부분을 볼 수 있는데

나누어진 이유가 typing 으로 인해서 나누어진다. 결국에는 3.10 을 보면 typing 을 import 하지 않는다. 
그만큼 기본 타입 지원범위가 넓어졌다고 볼 수 있다.

그리고 fastapi의 경우에는 프레임워크 자체가 type 에 대한 규약이 쎄다.

하지만 그렇다고 해서 스프링만큼의 성숙도를 가지냐라고 하면 또 아니다.

두번째다. 결국에는 프레임워크가 성숙도가 대체적으로 낮다.

이게 가장 큰 문제점이다.

발전 방향에 맞는 성숙도를 가진 프레임워크가 나와야하지만 그렇지 못하다.
그게 python 으로 개발을 하면서 가지는 문제점이다. 그러다보니 성숙도를 가진 프레임워크를 보고 문제 해결방법을 배우고 python 에 도입하려고 하는데 공부하면 할수록
그럴바에는 spring으로 개발하는 것이 낫지않나? 라고 생각한다.

그래서 요즘은 빠른 개발이 중요하면 python, 탄탄한 개발을 하고 싶으면 java 이 느낌이다.

결국에는 상황에 맞게 선택하는 것 같고 그에 대응할 수 있는 역량을 갖추는 것이 중요하다라고 생각하는 하루다.